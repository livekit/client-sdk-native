// Copyright 2023 LiveKit, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package livekit.proto;
option csharp_namespace = "LiveKit.Proto";

enum EncryptionType {
    None = 0;
    Gcm = 1;
    Custom = 2;
}

message KeyProviderOptions {
    uint32 ratchet_window_size = 1;
    bytes ratchet_salt = 2;
    bytes uncrypted_magic_bytes = 3;
}

message E2EEOptions {
  bool enabled = 1;
  bool is_shared_key = 2;
  string shared_key = 3;
  KeyProviderOptions key_provider_options = 4;
}

enum E2EEState {
    NEW = 0;
    OK = 1;
    ENCRYPTION_FAILED = 2;
    DECRYPTION_FAILED = 3;
    MISSING_KEY = 4;
    KEY_RATCHETED = 5;
    INTERNAL_ERROR = 6;
}

message SetFrameCryptorRequest {
    bool enabled = 1;
}

message SetFrameCryptorResponse {}

message SetSharedKeyRequest {
    bool enable_shared_key = 1;
    bytes shared_key = 2;
}

message SetSharedKeyResponse {}

message SetKeyForParticipantRequest {
    string sid = 1;
    bytes key = 2;
    uint32 key_index = 3;
}

message SetKeyForParticipantResponse {}

message RachetKeyForParticipantRequest {
    string sid = 1;
    uint32 key_index = 2;
}

message RachetKeyForParticipantResponse {
    bytes new_key = 1;
}

message FrameCryptorRequest {
    oneof message {
        SetFrameCryptorRequest set_frame_cryptor = 1;
        SetSharedKeyRequest set_shared_key = 2;
        SetKeyForParticipantRequest set_key_for_participant = 3;
        RachetKeyForParticipantRequest rachet_key_for_participant = 4;
    }
}

message FrameCryptorResponse {
    oneof message {
        SetFrameCryptorResponse set_frame_cryptor = 1;
        SetSharedKeyResponse set_shared_key = 2;
        SetKeyForParticipantResponse set_key_for_participant = 3;
        RachetKeyForParticipantResponse rachet_key_for_participant = 4;
    }
}